option_settings:
  aws:elb:listener:443:
    ListenerProtocol: HTTPS
    InstancePort: 80
  aws:elb:loadbalancer:
    CrossZone: true
  aws:elasticbeanstalk:environment:
    ServiceRole: aws-elasticbeanstalk-service-role
    LoadBalancerType: application
  aws:elasticbeanstalk:managedactions:
    ManagedActionsEnabled: true
    PreferredStartTime: TUE:01:46
  aws:autoscaling:updatepolicy:rollingupdate:
    RollingUpdateType: Health
    RollingUpdateEnabled: true
  aws:elasticbeanstalk:managedactions:platformupdate:
    UpdateLevel: minor
  aws:rds:dbinstance:
    DBEngineVersion: 9.5.4
    DBAllocatedStorage: '5'
    DBInstanceClass: db.t2.small
    DBEngine: postgres
    MultiAZDatabase: false
    DBDeletionPolicy: Snapshot
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: true
Resources:
    AWSEBRDSDatabase:
        Type: AWS::RDS::DBInstance
        Properties:
            AllocatedStorage: 5
            DBInstanceClass: db.t2.micro
            DBName: threatbuster
            Engine: postgres
            EngineVersion: 9.5.4
            MasterUsername: threatbuster
            MasterUserPassword: threatbuster
    ConfigS3Bucket:
        Type: "AWS::S3::Bucket"
        Properties:
          AccessControl: Private
          BucketName: { "Fn::Join" : ["config-", [{ "Ref" : "AWSEBEnvironmentName" }]]}
    ConfigS3BucketPolicy:
        Type: "AWS::IAM:Policy"
        Properties:
          Roles:
            - Fn::GetOptionSettings:
              OptionName: ServiceRole
          PolicyName: { "Fn::Join" : ["policy-config-read", [{ "Ref" : "AWSEBEnvironmentName" }]]}
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              -
                Effect: Allow
                Action:
                    - "s3:*"
                Resource:
                    - { "Fn::GetAtt" : [ "ConfigS3Bucket", "Arn"]}
                    - { "Fn::Join" : ["", [{ "Fn::GetAtt" : [ "ConfigS3Bucket", "Arn"] }, "/*" ]]}